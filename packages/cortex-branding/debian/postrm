#!/bin/bash
#
# Cortex Branding Post-Removal Script
#
# Cleans up after the package is removed.
#

set -e

case "$1" in
    purge|remove)
        # Update initramfs to remove Plymouth theme
        if command -v update-initramfs &>/dev/null; then
            update-initramfs -u 2>/dev/null || true
        fi

        # Update GRUB to remove theme reference
        if [ -f /etc/default/grub ]; then
            # Remove GRUB theme line if it points to cortex
            if grep -q 'GRUB_THEME=.*/cortex/' /etc/default/grub; then
                sed -i '/^GRUB_THEME=.*cortex/d' /etc/default/grub
            fi
            
            # Restore default distributor
            if grep -q 'GRUB_DISTRIBUTOR="Cortex Linux"' /etc/default/grub; then
                sed -i 's|GRUB_DISTRIBUTOR="Cortex Linux"|GRUB_DISTRIBUTOR="Debian"|' /etc/default/grub
            fi

            if command -v update-grub &>/dev/null; then
                update-grub 2>/dev/null || true
            fi
        fi

        # Update dconf
        if command -v dconf &>/dev/null; then
            dconf update 2>/dev/null || true
        fi
        ;;

    upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
        ;;

    *)
        echo "postrm called with unknown argument '$1'" >&2
        exit 1
        ;;
esac

exit 0

