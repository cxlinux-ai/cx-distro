#!/bin/bash
#
# Cortex Branding Pre-Removal Script
#
# Restores default system branding when the package is removed.
#

set -e

case "$1" in
    remove|upgrade|deconfigure)
        echo "Removing Cortex Linux branding..."

        # Restore Debian OS identity files
        # On Debian, /etc/os-release is a symlink to /usr/lib/os-release (from base-files)
        if [ -f /usr/lib/os-release ]; then
            echo "  -> Restoring Debian OS identity files..."
            ln -sf /usr/lib/os-release /etc/os-release
            # Restore generic Debian issue files
            echo "Debian GNU/Linux \\n \\l" > /etc/issue
            echo "Debian GNU/Linux" > /etc/issue.net
            # lsb-release can be regenerated by lsb-release package if installed
            if command -v lsb_release &>/dev/null; then
                cat > /etc/lsb-release << 'EOLSB'
DISTRIB_ID=Debian
DISTRIB_DESCRIPTION="Debian GNU/Linux"
EOLSB
            fi
        fi

        # Restore default Plymouth theme
        if command -v update-alternatives &>/dev/null; then
            update-alternatives --remove default.plymouth \
                /usr/share/plymouth/themes/cortex/cortex.plymouth 2>/dev/null || true
        fi

        if command -v plymouth-set-default-theme &>/dev/null; then
            plymouth-set-default-theme -R 2>/dev/null || true
        fi

        # Remove GDM theme alternative
        if command -v update-alternatives &>/dev/null; then
            update-alternatives --remove gdm3-theme.css \
                /usr/share/gnome-shell/theme/Cortex/gnome-shell.css 2>/dev/null || true
        fi

        # Re-enable default MOTD scripts
        if [ -d /etc/update-motd.d ]; then
            for f in /etc/update-motd.d/??-*; do
                [ -f "$f" ] && chmod +x "$f" 2>/dev/null || true
            done
        fi

        echo "Cortex Linux branding removed."
        ;;

    failed-upgrade)
        ;;

    *)
        echo "prerm called with unknown argument '$1'" >&2
        exit 1
        ;;
esac

exit 0

